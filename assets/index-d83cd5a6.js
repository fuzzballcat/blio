(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function l(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=l(n);fetch(n.href,r)}})();const z=document.getElementById("languagebar"),g=document.getElementById("srcinput"),S=[`'factorial of 5 is'
×/!5`,"⌽(⍒+\\' '=s)⊂s←' talF LPA .selur'",`s←'questionably, beatably, deniably, doubtedly,'
¯1&' un'⊥[' '=r]r←' ',s
'the best language ever'`];let E=Math.floor(Math.random()*S.length);document.getElementById("forward").addEventListener("click",e=>{E=(E+1)%S.length,g.value=S[E],g.dispatchEvent(new CustomEvent("input")),C.dispatchEvent(new CustomEvent("click"))},!1);document.getElementById("back").addEventListener("click",e=>{E=((E-1)%S.length+S.length)%S.length,g.value=S[E],g.dispatchEvent(new CustomEvent("input")),C.dispatchEvent(new CustomEvent("click"))},!1);g.value=S[E];g.addEventListener("keydown",e=>{e.keyCode===13&&e.shiftKey&&(runresult.innerText=A(g.value),e.preventDefault())},!1);const L="⍬ + ¯ - × ÷ ⌹ * ⍟ ↑ ↓ ~ | ⌈ ⌊ % < ≤ = ≥ > ≠ ≡ ≢ ⊃ ⊂ ⊆ ⊥ ⊤ ⍳ ⍸ ⍒ ⍋ ⌽ ⊖ & , ⍪ # ! ⍴ ⍣ / \\ ? ← ⍅ () '' ⍺ ⍵ ∇ {} [] ⋄ ⍝",w="+¯-×÷⌹*⍟↑↓~|⌈⌊%<≤=≥>≠≡≢⊃⊂⊆⊥⊤⍳⍸⍒⍋⌽⊖&,⍪#!⍴()∇",M="⍣/\\?",F="⍬1234567890.",D="←⍅()∇{}[]",U={"⍬":"Zilde","+":`Add
2→1`,"-":`Subtract
2→1`,"×":`Multiply
2→1`,"÷":`Divide
2→1`,"¯":`Negate
1→1`,"⌹":`Matrix inverse
1→1`,"*":`Exponent
2→1`,"⍟":`Logarithm
2→1`,"↑":`Maxmimum
2→1`,"↓":`Minimum
2→1`,"~":`Not
1→1`,"|":`Distance
2→1`,"⌈":`Ceiling
2→1`,"⌊":`Floor
2→1`,"%":`Mod
2→1`,"=":`Equals
2→1`,"≠":`Not equals
2→1`,"<":`Less
2→1`,"≤":`Less or equal
2→1`,"≥":`Greater or equal
2→1`,">":`Greater
2→1`,"≡":`Match
2→1`,"≢":`Not match
2→1`,"⊃":`Replicate
1→1`,"⊂":`Index
2→1`,"⊆":`Keep
2→1`,"⊥":`Splice
3→1`,"⊤":`Pick
3→1`,"⊖":`Rotate
2→1`,"⌽":`Reverse
1→1`,",":`Catenate
2→1`,"⍪":`Laminate
2→1`,"#":`Shape of
1→1`,"!":`Indices/Classify
1→1`,"⍳":`Indices-of
2→1`,"⍸":`Find sequence
2→1`,"&":`Take/drop
2→1`,"⍴":`Reshape
2→1`,"⍋":`Grade up
1→1`,"⍒":`Grade down
1→1`,"/":`Fold
1F`,"\\":`Scan
1F`,"⍣":`Repeat/Until
1F[1]/2F`,"?":`If
2F1`,"←":"Assign","⍅":"Function assign","()":"Array","⍺":"Left argument","⍵":"Right argument","∇":"Recur","{}":"Defined function","[]":"Axis-index","''":"String","⋄":"Statement separator","⍝":"Comment"},P=e=>D.includes(e)?"hi_k":w.includes(e)?"hi_f":M.includes(e)?"hi_m":e[0]==="'"?"hi_s":F.includes(e)?"hi_c":e[0]==="\\"?"hi_e":e[0]==="¯"?"hi_c":e[0]==="⍝"?"hi_l":!1;function G(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},l=s=>s.replace(/[&<>"'/]/ig,n=>t[n]);return e=e.split(/(⍝.*(?:\n|$))/).map(s=>s[0]!=="⍝"?s.split(/('(?:[^'\\]|\\.)*')/).map(n=>n[0]!=="'"?n.replace(new RegExp("¯[0-9.]|"+[...w,...M,...F].map(r=>r.match(/[0-9]/)?r:"\\"+r).join("|"),"g"),r=>'<span class="'+P(r)+'">'+l(r)+"</span>"):"<span class='hi_s'>"+n.split(/(\\.)/g).map(r=>r.length===2&&r[0]==="\\"?"<span class='hi_e'>"+l(r)+"</span>":r).join("")+"</span>").join(""):"<span class='hi_l'>"+l(s)+"</span>").join(""),e}const j=document.getElementById("srcdisplay");g.addEventListener("input",()=>{j.innerHTML=G(g.value)});j.innerHTML=G(g.value);function B(e,t){if(document.selection)e.focus(),document.selection.createRange().text=myValue;else if(e.selectionStart||e.selectionStart==="0"){const l=e.selectionStart;e.value=e.value.substring(0,l)+t+e.value.substring(e.selectionEnd,e.value.length),e.focus(),e.selectionStart=l+t.length,e.selectionEnd=l+t.length}else e.value+=t}for(let e of L.split(" ")){const t=document.createElement("button");t.classList.add("glyphbutton");const l=P(e);l&&t.classList.add(l),t.innerText=e,z.appendChild(t);const s=document.createElement("div");s.classList.add("glyphbuttontooltip"),s.innerText=U[e],t.appendChild(s),t.addEventListener("click",n=>{B(g,e),g.dispatchEvent(new CustomEvent("input")),e.length>1&&(g.focus(),g.selectionStart--,g.selectionEnd--)},!1)}const C=document.getElementById("run");C.addEventListener("click",e=>{runresult.innerText=A(g.value)},!1);function V(e){let t=[];for(let l=0;l<e.length;l++){let s=e[l];if(s!==" ")if(s==="'"){let n="";do if(s==="\\"&&(s=e[++l]),n+=s,s=e[++l],l>=e.length)return[!1,"Expected string terminator",l];while(s!="'");t.push(n)}else if(s.match(/[a-z]/i)){let n="";for(;s.match(/[a-z]/i)&&(n+=s,s=e[++l],!(l>=e.length)););l--,t.push(n)}else if(s==="¯"&&l<e.length-1&&(e[l+1]==="."||e[l+1].match(/[0-9]/))||s==="."||s.match(/[0-9]/)){let n=1;s==="¯"&&(n=-1,s=e[++l]);let r="";for(;s.match(/[0-9]/)&&(r+=s,s=e[++l],!(l>=e.length)););if(s==="."&&(r+=s,s=e[++l],l<e.length))for(;s.match(/[0-9]/)&&(r+=s,s=e[++l],!(l>=e.length)););l--,t.push(n*parseFloat(r))}else if(s===`
`||L.includes(s))t.push(s);else return[!1,"Unknown token "+s,l]}return t}function c(e,t){return{shape:e,ravel:t}}function H(e){if(typeof e[0]=="number")if(e.length>1&&typeof e[1]=="number"){let t=[e.shift()];for(;e.length>0&&typeof e[0]=="number";)t.push(e.shift());return{type:"CONST",value:c([t.length],t)}}else return{type:"CONST",value:e.shift()};else{if(e[0]==="⍬")return e.shift(),{type:"CONST",value:c([0],[])};if(e[0]==="⍵")return e.shift(),{type:"OMEGA"};if(e[0]==="⍺")return e.shift(),{type:"ALPHA"};if(e[0].length&&e[0][0]==="'"){const t=e.shift();return{type:"CONST",value:t.length===2?t.slice(1):c([t.length-1],[...t.slice(1)])}}else{if(typeof e[0]=="string"&&!L.includes(e[0]))return{type:"NAME",value:e.shift()};if(e[0]==="("){e.shift();let t=x(e),l=!1;for(;`⋄
`.includes(e[0]);){e.shift();let s=x(e);t={type:"CALL",fn:{type:"PRIMITIVE",value:l?",":"⍪"},lhs:t,rhs:s},l=!0}return e.length<1||e[0]!==")"?[!1,"Expected closing )"]:(e.shift(),t)}else return[!1,"Syntax error: expected expression"]}}}function J(e){if(e[0]==="{"){e.shift();const t=JSON.parse(JSON.stringify(e)),l=q(e);if(l.length&&l[0]===!1)return l;if(e.length<1||e[0]!=="}")return[!1,"Mismatched {"];e.shift(),t.splice(t.length-e.length,e.length);let s=!1;for(let n of t)if(n==="⍺"){s=!0;break}return{type:"FUNCTION",dyadic:s,expression:l}}else return typeof e[0]=="string"&&w.includes(e[0])?{type:"PRIMITIVE",value:e.shift()}:typeof e[0]=="string"&&!L.includes(e[0])?{type:"NAME",value:e.shift()}:[!1,"Syntax error: expected a function"]}function R(e){let t=J(e);if(t.length&&t[0]===!1)return t;for(;typeof e[0]=="string"&&M.includes(e[0]);){const l=e.shift();if(t={type:"MODIFIER",modifier:l,fn:t},l==="⍣"&&e.length&&e[0]==="["){if(e.shift(),t.modifier="⌺",t.count=x(e),e.length<1||e[0]!=="]")return[!1,"Expected closing ]"];e.shift();continue}if(l==="?"||l==="⍣"){let s=J(e);if(s.length&&s[0]===!1)return s;t.fn2=s}}return t}const T=`)]}
⋄⍝`;function K(e){return e==="("||e==="⍵"||e==="⍺"||typeof e=="string"&&!L.includes(e)&&X(e[0])||typeof e=="number"||e==="⍬"||e.length&&e[0]==="'"}function X(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}function x(e){if(e.length===0||T.includes(e[0]))return[!1,"Expected an expression."];let t;if(K(e[0])&&(t=H(e),t.length&&t[0]===!1))return t;if(e.length>0&&!T.includes(e[0])){if(e[0]==="←"){if(t.type!="NAME")return[!1,"Expected a name to assign to"];e.shift();let r=x(e);return r.length&&r[0]===!1?r:{type:"ASSIGN",name:t.value,value:r}}else if(e[0]==="⍅"){if(t.type!="NAME")return[!1,"Expected a name to assign to"];e.shift();let r=R(e);return r.length&&r[0]===!1?r:{type:"ASSIGNFN",name:t.value[0].toUpperCase()+t.value.slice(1),fn:r}}let l=R(e),s;if(e.length>0&&e[0]==="["){if(e.shift(),s=x(e),e.length<1||e[0]!=="]")return[!1,"Expected closing ]"];e.shift()}if(l.length&&l[0]===!1)return l;let n=x(e);if(n.length&&n[0]===!1)return n;t={type:"CALL",fn:l,lhs:t,rhs:n,bracket:s}}return t}function q(e,t){for(;e.length>0&&`
⋄⍝`.includes(e[0]);)if(e.shift()==="⍝")for(;e.length>0&&e[0]!==`
`;)e.shift();let l=[];for(let s=0;s<100&&e.length>0&&e[0]!=="}";s++){const n=x(e);if(n.length&&n[0]===!1)return n;for(l.push(n);e.length>0&&`
⋄⍝`.includes(e[0]);)if(e.shift()==="⍝")for(;e.length>0&&e[0]!==`
`;)e.shift()}return{type:"EXPRLIST",exprs:l,toplevel:t}}function Z(e){const t=q(e,!0);return t.length>0&&t[0]===!1?t:e.length>0?[!1,"Mismatched }"]:t}function $(e){if(typeof e=="object"){let t=[],l=1;for(let n=e.shape.length-1;n>=0;n--)l*=e.shape[n],t.push(l);let s="";e.ravel.length||(e.shape.length>1?s+=e.shape+"⍴0":s+="⍬");for(let n=0;n<e.ravel.length;n++){if(n!==0)for(let r of t)n%r===0&&(s+=`
`);s+=""+e.ravel[n]+(typeof e.ravel[n]=="string"?"":" ")}return s}else return""+e}function Q(e,t,l){let s=[];for(let n=0;n<l;n++)for(let r=0;r<l;r++){let a=0;for(let i=0;i<l;i++)a+=e[n*l+i]*t[i*l+r];s.push(a)}return s}function W(e){if(o(e))return 1/e;if(e.shape.length===1){let h=e.ravel.map(f=>f*f).reduce((f,u)=>f+u,0);return e.map(f=>f/h)}if(e.shape.length>2||e.shape[0]!==e.shape[1])return[!1,"⌹: Shape error"];const t=e.shape[0],l=e.ravel,s=[];for(let h=0;h<t*t;h++)s.push(+(h%(t+1)===0));let n;function r(h){if(h===0)return[[1],s];let[f,u]=r(h-1),p=Q(l,u,t),_=0;for(let v=0;v<t;v++)_+=p[v*t+v];_/=-h;let k=[];for(let v=0;v<t;v++)for(let I=0;I<t;I++)k.push(p[v*t+I]+s[v*t+I]*_);return h===t-1&&(n=k),[f.concat(_),k]}const a=r(t)[0],i=a[a.length-1];if(i===0)return[!1,"⌹: Domain error"];for(let h=0;h<t*t;h++)n[h]/=-i;return c([t,t],n)}function o(e){return typeof e=="number"||typeof e=="string"}function N(e,t){if(typeof e!=typeof t)return 0;if(o(e))return+(e===t);if(e.shape.length!=t.shape.length)return 0;for(let l=0;l<e.shape.length;l++)if(e.shape[l]!==t.shape[l])return 0;if(e.ravel.length!=t.ravel.length)return 0;for(let l=0;l<e.ravel.length;l++)if(!N(e.ravel[l],t.ravel[l]))return 0;return 1}function Y(e,t,l){const s=o(t),n=o(l);if(s&&n)return e(t,l);if(s){let i=[];for(let h=0;h<l.ravel.length;h++)i.push(e(t,l.ravel[h]));return c(l.shape,i)}if(n){let i=[];for(let h=0;h<t.ravel.length;h++)i.push(e(t.ravel[h],l));return c(t.shape,i)}const r=Math.min(t.shape.length,l.shape.length);let a=!0;for(let i=0;i<r;i++)if(t.shape[i]!=l.shape[i]){a=!1;break}if(a)if(t.shape.length>l.shape.length){const i=t.shape.slice(r).reduce((f,u)=>f*u,1);let h=[];for(let f=0;f<l.ravel.length;f++){const u=l.ravel[f];for(let p=0;p<i;p++)h.push(e(t.ravel[f*i+p],u))}return c(t.shape,h)}else{const i=l.shape.slice(r).reduce((f,u)=>f*u,1);let h=[];for(let f=0;f<t.ravel.length;f++){const u=t.ravel[f];for(let p=0;p<i;p++)h.push(e(u,l.ravel[f*i+p]))}return c(l.shape,h)}}function b(e,t){if(o(t))return e(t);let l=[];for(let s=0;s<t.ravel.length;s++)l.push(e(t.ravel[s]));return c(t.shape,l)}const ee=["+","-","×","÷","*","⍟","↑","↓","%","=","≠","<",">","≤","≥"],te=[(e,t)=>e+t,(e,t)=>e-t,(e,t)=>e*t,(e,t)=>e/t,Math.pow,(e,t)=>Math.log(e)/Math.log(t),Math.max,Math.min,(e,t)=>(e%t+t)%t,(e,t)=>+(e===t),(e,t)=>+(e!==t),(e,t)=>+(e<t),(e,t)=>+(e>t),(e,t)=>+(e<=t),(e,t)=>+(e>=t)];function ne(e,t,l){const s=ee.indexOf(e);let n=Y(te[s],t,l);return n===void 0?[!1,e+": Shape mismatch"]:n}const re=["¯","~","⌈","⌊"],le=[e=>-e,e=>+!e,Math.ceil,Math.floor];function se(e,t){const l=re.indexOf(e);return b(le[l],t)}function ie(e,t,l,s){switch(e){case"¯":case"~":case"⌈":case"⌊":return l!==void 0?[!1,e+": Too many values"]:se(e,t);case"+":case"-":case"×":case"÷":case"*":case"⍟":case"↑":case"↓":case"%":case"=":case"≠":case"<":case">":case"≤":case"≥":return l===void 0?[!1,e+": Expected another value"]:ne(e,l,t);case"⌹":return l!==void 0?[!1,"⌹: Too many values"]:W(t);case"|":{if(l===void 0)return[!1,"|: Expected another value"];if(o(t)&&o(l))return Math.abs(t-l);if(typeof t!=typeof l)return[!1,"|: Rank error"];if(t.ravel.length!=l.ravel.length)return[!1,"|: Length error"];let n=0;for(let r=0;r<t.ravel.length;r++){const a=t.ravel[r],i=l.ravel[r];n+=Math.pow(i-a,2)}return Math.sqrt(n)}case"≡":return l===void 0?[!1,"≡: Expected another value"]:N(t,l);case"≢":return l===void 0?[!1,"≡: Expected another value"]:+!N(t,l);case"⊂":{if(l===void 0)return[!1,"⊂: Expected another value"];const n=t.ravel.length/t.shape[0];if(o(l)){const a=(l-1)*n;return t.shape.length===1?t.ravel[a]:c(t.shape.slice(1),t.ravel.slice(a,a+n))}let r=[];for(let a=0;a<l.ravel.length;a++){const i=(l.ravel[a]-1)*n;r=r.concat(t.ravel.slice(i,i+n))}return c(l.shape.concat(t.shape.slice(1)),r)}case"⊃":{if(l!==void 0)return[!1,"⊃: Too many values"];if(o(t)&&(t=c([1],[t])),t.shape.length>1)return[!1,"⊃: Rank error"];let n=[];for(let r=0;r<t.ravel.length;r++)for(let a=0;a<t.ravel[r];a++)n.push(r+1);return c([n.length],n)}case"⊥":{if(l===void 0||s===void 0)return[!1,"⊥: Expected another value"];const n=s,r=l,a=t;if(a.shape.length!=r.shape.length)return[!1,"⊥: Rank mismatch"];for(let f=1;f<a.shape.length;f++)if(a.shape[f]!=r.shape[f])return[!1,"⊥: Shape mismatch"];if(n.shape[0]!=a.shape[0])return[!1,"⊥: Length mismatch"];let i=a.shape.slice(1).reduce((f,u)=>f*u,1),h=c([0,...a.shape.slice(1)],[]);for(let f=0;f<n.ravel.length;f++)n.ravel[f]?(h.ravel=h.ravel.concat(r.ravel),h.shape[0]+=r.shape[0]):(h.ravel=h.ravel.concat(a.ravel.slice(f*i,f*i+i)),h.shape[0]++);return h}case"⊤":{const n=s;if(t.shape.length!=l.shape.length)return[!1,"⊤: Rank mismatch"];for(let i=0;i<t.shape.length;i++)if(t.shape[i]!=l.shape[i])return[!1,"⊤: Shape mismatch"];if(n.shape[0]!=t.shape[0])return[!1,"⊤: Length mismatch"];let r=t.shape.slice(1).reduce((i,h)=>i*h,1),a=c(t.shape,[]);for(let i=0;i<n.ravel.length;i++)n.ravel[i]?a.ravel=a.ravel.concat(t.ravel.slice(i*r,i*r+r)):a.ravel=a.ravel.concat(l.ravel.slice(i*r,i*r+r));return a}case"⊆":{let n=l;const r=t;if(o(r)&&o(n)){let f=[];for(let u=0;u<n;u++)f.push(r);return c([f.length],f)}if(typeof r!=typeof n)return[!1,"⊆: Rank mismatch"];if(n.ravel.length!=r.shape[0])return[!1,"⊆: Length mismatch"];let a=[],i=0,h=r.ravel.length/r.shape[0];for(let f=0;f<n.ravel.length;f++)for(let u=0;u<n.ravel[f];u++)a=a.concat(r.ravel.slice(f*h,f*h+h)),i++;return c([i,...r.shape.slice(1)],a)}case"⊖":{const n=JSON.parse(JSON.stringify(t)),r=n.ravel.length/n.shape[0];if(l>0)for(let a=0;a<l;a++){const i=n.ravel.splice(0,r);n.ravel=n.ravel.concat(i)}else for(let a=0;a<-l;a++){const i=n.ravel.splice(n.ravel.length-r,r);n.ravel=i.concat(n.ravel)}return n}case"⌽":{const n=t.shape[0],r=t.ravel.length/n,a=JSON.parse(JSON.stringify(t));for(let i=0;i<n/2;i++){let h=a.ravel.slice(i*r,i*r+r);const f=n-i-1;a.ravel.splice(i*r,r,...a.ravel.slice(f*r,f*r+r)),a.ravel.splice(f*r,r,...h)}return a}case"⍪":{if(o(t)&&(t=c([1],[t])),o(l)&&(l=c([1],[l])),t.shape.length!==l.shape.length)return[!1,"Laminate: Rank error"];for(let r=0;r<t.shape.length;r++)if(t.shape[r]!==l.shape[r])return[!1,"Laminate: Shape error"];let n=JSON.parse(JSON.stringify(l));return n.shape.unshift(2),n.ravel=n.ravel.concat(t.ravel),n}case",":{o(t)&&(t=c([1],[t])),o(l)&&(l=c([1],[l]));let n=JSON.parse(JSON.stringify(l));if(l.shape.length===t.shape.length){for(let r=1;r<l.shape.length;r++)if(l.shape[r]!==t.shape[r])return[!1,",: Shape mismatch"];n.shape[0]+=t.shape[0]}else if(l.shape.length===t.shape.length+1){for(let r=1;r<n.shape.length;r++)if(n.shape[r]!==t.shape[r-1])return[!1,",: Shape mismatch"];n.shape[0]++}else if(t.shape.length===n.shape.length+1){for(let r=1;r<t.shape.length;r++)if(t.shape[r]!==n.shape[r-1])return[!1,",: Shape mismatch"];n.shape=t.shape,n.shape[0]++}else return[!1,",: Shape mismatch"];return n.ravel=n.ravel.concat(t.ravel),n}case"#":return o(t)?c([0],[]):c([t.shape.length],t.shape);case"!":{let n=[];if(o(t)){for(let r=0;r<t;r++)n.push(r+1);return c([n.length],n)}else{let r=[];for(let a=0;a<t.ravel.length;a++){const i=r.findIndex(h=>N(t.ravel[a],h));i<0?(r.push(t.ravel[a]),n.push(r.length)):n.push(i+1)}return c(t.shape,n)}}case"⍳":{if(o(l)&&(l=c([1],[l])),o(t)&&(t=c([1],[t])),t.shape.length!==l.shape.length)return[!1,"⍳: Rank error"];for(let i=1;i<l.shape.length;i++)if(t.shape[i]!==l.shape[i])return[!1,"⍳: Rank error"];let n=c([0],[]),r=c([0,...t.shape.slice(1)],[]);const a=t.ravel.length/t.shape[0];for(let i=0;i<t.shape[0];i++)r.ravel=r.ravel.concat(t.ravel.slice(i*a,i*a+a)),r.shape[0]++,r.shape[0]>l.shape[0]&&(r.ravel.splice(0,a),r.shape[0]--),N(r,l)&&(n.ravel.push(i-l.shape[0]+2),n.shape[0]++);return n}case"⍸":{o(l)&&(l=c([1],[l])),o(t)&&(t=c([1],[t]));let n=c([0],[]),r=c([0,...t.shape.slice(1)],[]);const a=t.ravel.length/t.shape[0];for(let i=0;i<t.shape[0];i++)r.ravel=r.ravel.concat(t.ravel.slice(i*a,i*a+a)),r.shape[0]++,n.ravel.push(0),n.shape[0]++,r.shape[0]>l.shape[0]&&(r.ravel.splice(0,a),r.shape[0]--),N(r,l)&&(n.ravel[i-l.shape[0]+1]=1);return n}case"&":{o(t)&&(t=c([1],[t]));let n=JSON.parse(JSON.stringify(t));return l<0?(n.ravel=n.ravel.slice(-l*n.ravel.length/n.shape[0],n.ravel.length),n.shape[0]-=l):(n.ravel=n.ravel.slice(0,l*n.ravel.length/n.shape[0]),n.shape[0]=l),n}case"⍴":{if(o(l)&&(l=c([1],[l])),l.shape.length>1)return[!1,"Cannot reshape with non-vector shape."];let n=t;o(n)&&(n=c([1],[n]));let r=[];const a=l.ravel.reduce((i,h)=>i*h,1);for(let i=0;i<a;i++)r.push(n.ravel[i%n.ravel.length]);return c(l.ravel,r)}case"⍋":{let n=t.ravel;for(let r=0;r<n.length;r++)n[r]=[n[r],r];return n.sort(function(r,a){return r[0]<a[0]?-1:1}),c(t.shape,n.map(r=>r[1]+1))}case"⍒":{let n=t.ravel;for(let r=0;r<n.length;r++)n[r]=[n[r],r];return n.sort(function(r,a){return r[0]>a[0]?-1:1}),c(t.shape,n.map(r=>r[1]+1))}default:return[!1,"internalerror on function '"+JSON.stringify(e)+"'"]}}function m(e,t,l,s){if(e.type==="MODIFIER")switch(e.modifier){case"/":{const n=t,r=n.ravel.length/n.shape[0];if(n.shape[0]===0)return c(n.shape.slice(1),new Array(n.shape.slice(1).reduce((a,i)=>a*i,1)).fill().map(a=>0));if(n.shape[0]===1)return n.shape.length===1?n.ravel[0]:c(n.shape.slice(1),n.ravel);{const a=n.ravel.slice(0,r);let i=n.shape.length===1?a[0]:c(n.shape.slice(1),a);for(let h=1;h<n.shape[0];h++){const f=n.ravel.slice(h*r,h*r+r),u=m(e.fn,n.shape.length===1?f[0]:c(n.shape.slice(1),f),i);if(u.length&&u[0]===!1)return u;i=u}return i}}case"\\":{const n=t,r=n.ravel.length/n.shape[0];if(n.shape[0]===0)return c([0,...n.shape.slice(1)],[]);if(n.shape[0]===1)return c([1,...n.shape.slice(1)],n.ravel);{let a=c(n.shape,[]);const i=n.ravel.slice(0,r);let h=n.shape.length===1?i[0]:c(n.shape.slice(1),i);a.ravel=a.ravel.concat(i);for(let f=1;f<n.shape[0];f++){const u=n.ravel.slice(f*r,f*r+r),p=m(e.fn,n.shape.length===1?u[0]:c(n.shape.slice(1),u),h);if(p.length&&p[0]===!1)return p;a.ravel=a.ravel.concat(o(p)?p:p.ravel),h=p}return a}}case"?":{const n=t;return(o(n)?n:n.ravel[0])?m(e.fn):m(e.fn2)}case"⍣":{let n=t;for(;;){const r=m(e.fn,n,l);if(r.length&&r[0]===!1)return r;const a=m(e.fn2,r,n);if(a.length&&a[0]===!1)return a;if(a===1)break;n=r}return n}case"⌺":{let n=t;for(let r=0;r<y(e.count);r++)if(n=m(e.fn,n,l),n.length&&n[0]===!1)return n;return n}default:return[!1,"internalerror on modifier '"+JSON.stringify(e.modifier)+"'"]}else return e.type==="FUNCTION"?l!==void 0!==e.dyadic?[!1,"error: Function called with incorrect arity"]:y(e.expression,t,l):e.type==="NAME"?m(d[e.value],t,l,s):e.type!=="PRIMITIVE"?[!1,"internalerror on function type '"+JSON.stringify(e)+"'"]:ie(e.value,t,l,s)}let d={},O;function y(e,t,l){switch(e.type){case"EXPRLIST":{let s=O;O={type:"FUNCTION",dyadic:l!==void 0,expression:e};const n=JSON.parse(JSON.stringify(d));if(e.toplevel){let r="";for(let a of e.exprs){const i=y(a,t,l);if(i.length&&i[0]===!1)return i;a.type!=="ASSIGN"&&(r=r+`
`+$(i))}return O=s,d=n,r}else{let r;for(let a of e.exprs)if(r=y(a,t,l),r.length&&r[0]===!1)return r;return O=s,d=n,r}}case"ASSIGN":{const s=y(e.value,t,l);return s&&s.length&&s[0]===!1?s:(d[e.name]=s,JSON.parse(JSON.stringify(d[e.name])))}case"NAME":return JSON.parse(JSON.stringify(d[e.value]));case"CONST":return e.value;case"CALL":{const s=e.rhs?y(e.rhs,t,l):e.rhs;if(s&&s.length&&s[0]===!1)return s;const n=e.bracket?y(e.bracket,t,l):e.bracket;if(n&&n.length&&n[0]===!1)return n;const r=e.lhs?y(e.lhs,t,l):e.lhs;return r&&r.length&&r[0]===!1?r:m(e.fn,s,r,n)}case"OMEGA":return JSON.parse(JSON.stringify(t));case"ALPHA":return JSON.parse(JSON.stringify(l));case"ASSIGNFN":return e.fn.type==="PRIMITIVE"&&e.fn.value==="∇"?d[e.name]=O:d[e.name]=e.fn,!1;default:return[!1,"internalerror: node type "+e.type]}}function A(e){let t=V(e);if(t.length&&t[0]===!1){let n="error: "+t[1]+`

`,r=0;for(let a of e.split(`
`)){const i=r;if(r+=a.length+1,r>t[2]){n+=a+`
`,n+=" ".repeat(t[2]-i),n+=`↑ here
`;break}}return n}const l=Z(t);if(l.length&&l[0]===!1){let n="";for(let r=0;r<t.length&&t[r]!==`
`;r++)n+=t[r].length&&t[r][0]==="'"?t[r]+"'":t[r],n+=" ";return l[1]+`

... `+n+`
    ↑ here`}d={};let s=y(l);return s.length&&s[0]===!1?s[1]:s}runresult.innerText=A(g.value);
