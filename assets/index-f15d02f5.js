(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const b=document.getElementById("languagebar"),d=document.getElementById("srcinput"),S=["'factorial of 5 is' 5 { ∇⍆s ¨2<?{∵1}{¨1-s×} }","',oN s\\'ereht on gninaem ot eht .eman'¨' '=¨\\+2×⍨-⍒⊂⌽",`'questionably beatably deniably doubtedly'→s
s' ',¨' '=2×1+⊆→r
' un' r' '=/+⍴r¨' '≠⊆, r' '=⍋⍋⊂1¯&`];let O=Math.floor(Math.random()*S.length);document.getElementById("forward").addEventListener("click",s=>{O=(O+1)%S.length,d.value=S[O],d.dispatchEvent(new CustomEvent("input")),P.dispatchEvent(new CustomEvent("click"))},!1);document.getElementById("back").addEventListener("click",s=>{O=((O-1)%S.length+S.length)%S.length,d.value=S[O],d.dispatchEvent(new CustomEvent("input")),P.dispatchEvent(new CustomEvent("click"))},!1);d.value=S[O];d.addEventListener("keydown",s=>{s.keyCode===13&&s.shiftKey&&(runresult.innerText=F(d.value),s.preventDefault())},!1);const M="⍬ + ¯ - × ÷ ⌹ * ⍟ ↑ ↓ ~ | ⌈ ⌊ % < ≤ = ≥ > ≠ ≡ ≢ ⊃ ⊂ ⊆ ⍳ ⍸ ⍒ ⍋ ⌽ ⊖ & , # ! ⍴ ∘ ¨ ⍨ ∵ ⍩ ⍣ ⍤ / \\ ? → ⍆ () '' ∇ {}",C="+¯-×÷⌹*⍟↑↓~|⌈⌊%<≤=≥>≠≡≢⊃⊂⊆⍳⍸⍒⍋⌽⊖&,#!⍴∘¨⍨∵()∇",D="⍩⍤⍣/\\?",U="⍬1234567890.",Q="∘¨⍨∵→⍆()∇{}",H={"⍬":"Zilde","+":`Add
2→1`,"-":`Subtract
2→1`,"×":`Multiply
2→1`,"÷":`Divide
2→1`,"¯":`Negate
1→1`,"⌹":`Matrix inverse
1→1`,"*":`Exponent
2→1`,"⍟":`Logarithm
2→1`,"↑":`Maxmimum
2→1`,"↓":`Minimum
2→1`,"~":`Not
1→1`,"|":`Distance
2→1`,"⌈":`Ceiling
2→1`,"⌊":`Floor
2→1`,"%":`Mod
2→1`,"=":`Equals
2→1`,"≠":`Not equals
2→1`,"<":`Less
2→1`,"≤":`Less or equal
2→1`,"≥":`Greater or equal
2→1`,">":`Greater
2→1`,"≡":`Match
2→1`,"≢":`Not match
2→1`,"⊃":`Replicate
1→1`,"⊂":`Index
2→1`,"⊆":`Keep
2→1`,"⊖":`Rotate
2→1`,"⌽":`Reverse
1→1`,",":`Catenate
2→1`,"#":`Shape of
1→1`,"!":`Indices/Classify
1→1`,"⍳":`Indices-of
2→1`,"⍸":`Find sequence
2→1`,"&":`Take/drop
2→1`,"⍴":`Reshape
2→1`,"⍋":`Grade up
1→1`,"⍒":`Grade down
1→1`,"∘":`Noop
1→1`,"¨":`Dup
1→2`,"⍨":`Swap
2→2`,"∵":`Pop
1→0`,"⍩":`Dip
1F`,"/":`Fold
1F`,"\\":`Scan
1F`,"⍣":`Repeat
1F1`,"⍤":`Until
2F`,"?":`If
2F1`,"→":"Assign","⍆":"Function assign","()":`Stack to array
?→1`,"∇":"Recur","{}":"Defined function","''":"String"},G=s=>Q.includes(s)?"hi_k":C.includes(s)?"hi_f":D.includes(s)?"hi_m":s[0]==="'"?"hi_s":U.includes(s)?"hi_c":s[0]==="\\"?"hi_e":!1;function _(s){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},t=n=>n.replace(/[&<>"'/]/ig,a=>e[a]);return s=s.split(new RegExp("(?<=(?<!\\\\)(?:\\\\\\\\)*)\\'")),s=s.map((n,a)=>a%2===0?n.replace(new RegExp([...C,...D,...U].map(i=>i.match(/[0-9]/)?i:"\\"+i).join("|"),"g"),i=>'<span class="'+G(i)+'">'+t(i)+"</span>"):a!==s.length-1?"<span class='hi_s'>'"+n.split(/(\\.)/g).map(i=>i.length===2&&i[0]==="\\"?"<span class='hi_e'>"+t(i)+"</span>":i).join("")+"'</span>":"<span class='hi_s'>'"+t(n)+"</span>").join(""),s}const x=document.getElementById("srcdisplay");d.addEventListener("input",()=>{x.innerHTML=_(d.value)});x.innerHTML=_(d.value);function j(s,e){if(document.selection)s.focus(),document.selection.createRange().text=myValue;else if(s.selectionStart||s.selectionStart==="0"){const t=s.selectionStart;s.value=s.value.substring(0,t)+e+s.value.substring(s.selectionEnd,s.value.length),s.focus(),s.selectionStart=t+e.length,s.selectionEnd=t+e.length}else s.value+=e}for(let s of M.split(" ")){const e=document.createElement("button");e.classList.add("glyphbutton");const t=G(s);t&&e.classList.add(t),e.innerText=s,b.appendChild(e);const n=document.createElement("div");n.classList.add("glyphbuttontooltip"),n.innerText=H[s],e.appendChild(n),e.addEventListener("click",a=>{j(d,s),d.dispatchEvent(new CustomEvent("input")),s.length>1&&(d.focus(),d.selectionStart--,d.selectionEnd--)},!1)}const P=document.getElementById("run");P.addEventListener("click",s=>{runresult.innerText=F(d.value)},!1);function J(s){let e=[];for(let t=0;t<s.length;t++){let n=s[t];if(n!==" ")if(n==="'"){let a="";do if(n==="\\"&&(n=s[++t]),a+=n,n=s[++t],t>=s.length)return[!1,"Expected string terminator",t];while(n!="'");e.push(a)}else if(n===`
`||M.includes(n))e.push(n);else if(n.match(/[a-z]/i)){let a="";for(;n.match(/[a-z]/i)&&(a+=n,n=s[++t],!(t>=s.length)););t--,e.push(a)}else if(n==="."||n.match(/[0-9]/)){let a="";for(;n.match(/[0-9]/)&&(a+=n,n=s[++t],!(t>=s.length)););if(n==="."&&(a+=n,n=s[++t],t<s.length))for(;n.match(/[0-9]/)&&(a+=n,n=s[++t],!(t>=s.length)););t--,e.push(parseFloat(a))}else return[!1,"Unknown token "+n,t]}return e}const r=["CONST","FOPEN","FUNCTION","ASSIGN","ASSIGNFN","NAME","ADD","NEGATE","SUB","MUL","DIV","EXP","LOG","MATINV","ARROPEN","ARRCLOSE","MAX","MIN","MOD","NOT","DISTANCE","CEILING","FLOOR","MATCH","NMATCH","EQUAL","NEQUAL","LESS","GREATER","LESSEQ","GREATEREQ","INDEX","KEEP","REPLICATE","ROTATE","REVERSE","CATENATE","SHAPEOF","INDICES","INDICESOF","FINDSEQ","TAKEDROP","RESHAPE","GRADEUP","GRADEDOWN","DUP","SWAP","POP","RECUR","NOOP","DIP","REPEAT","UNTIL","FOLD","SCAN","IF"].map((s,e)=>({[s]:e+1})).reduce((s,e)=>({...s,...e}));function f(s,e){return{shape:s,ravel:e}}function V(s){let e=0;const t=[];for(;e<s.length;){const n=s[e];if(typeof n=="number")t.push(r.CONST,n);else if(n==="{")t.push(r.FOPEN);else if(n==="}"){let a=[];for(;;){if(t.length===0)return[!1,"Mismatched }"];const i=t.pop();if(i===r.FOPEN){let h=0;for(;t.length>0&&h<t.length&&t[t.length-1-h]===r.CONST;)h++;if(h%2===0)break}a.push(i)}t.push(r.FUNCTION,a.reverse())}else if(n==="→"){if(e++,e>=s.length)return[!1,"expected name after →"];if(typeof s[e]!="string")return[!1,"expected name after →"];t.push(r.ASSIGN,s[e])}else if(n==="⍆"){if(e++,e>=s.length)return[!1,"expected name after →"];if(typeof s[e]!="string")return[!1,"expected name after →"];let a=t.pop();Array.isArray(a)&&t.pop(),t.push(r.ASSIGNFN,s[e],[r.FUNCTION,a])}else if(n.length&&n[0]==="'")t.push(r.CONST,n.length===2?n.slice(1):f([n.length-1],[...n.slice(1)]));else if(n==="⍬")t.push(r.CONST,f([0],[]));else if(typeof n=="string"&&C.includes(n)){const a={"+":r.ADD,"-":r.SUB,"×":r.MUL,"÷":r.DIV,"*":r.EXP,"⍟":r.LOG,"⌹":r.MATINV,"¯":r.NEGATE,"↑":r.MAX,"↓":r.MIN,"~":r.NOT,"|":r.DISTANCE,"⌈":r.CEILING,"⌊":r.FLOOR,"%":r.MOD,"=":r.EQUAL,"≠":r.NEQUAL,"<":r.LESS,">":r.GREATER,"≤":r.LESSEQ,"≥":r.GREATEREQ,"≡":r.MATCH,"≢":r.NMATCH,"⊃":r.REPLICATE,"⊂":r.INDEX,"⊆":r.KEEP,"⌽":r.REVERSE,"⊖":r.ROTATE,",":r.CATENATE,"#":r.SHAPEOF,"!":r.INDICES,"⍳":r.INDICESOF,"⍸":r.FINDSEQ,"&":r.TAKEDROP,"⍴":r.RESHAPE,"⍋":r.GRADEUP,"⍒":r.GRADEDOWN,"(":r.ARROPEN,")":r.ARRCLOSE,"∇":r.RECUR,"∘":r.NOOP,"¨":r.DUP,"⍨":r.SWAP,"∵":r.POP}[n];if(a===void 0)return[!1,"internalerror on '"+n+"'"];t.push(a)}else if(typeof n=="string"&&D.includes(n)){const a={"/":r.FOLD,"\\":r.SCAN,"⍩":r.DIP,"⍣":r.REPEAT,"⍤":r.UNTIL,"?":r.IF}[n];if(a===void 0)return[!1,"internalerror on '"+n+"'"];t.push(a)}else if(typeof n=="string")t.push(r.NAME,n);else return[!1,"parse error on '"+n+"'"];e++}return t}function X(s,e,t){let n=[];for(let a=0;a<t;a++)for(let i=0;i<t;i++){let h=0;for(let c=0;c<t;c++)h+=s[a*t+c]*e[c*t+i];n.push(h)}return n}function B(s){if(E(s))return 1/s;if(s.shape.length===1){let o=s.ravel.map(p=>p*p).reduce((p,u)=>p+u,0);return s.map(p=>p/o)}if(s.shape.length>2||s.shape[0]!==s.shape[1])return[!1,"⌹: Shape error"];const e=s.shape[0],t=s.ravel,n=[];for(let o=0;o<e*e;o++)n.push(+(o%(e+1)===0));let a;function i(o){if(o===0)return[[1],n];let[p,u]=i(o-1),g=X(t,u,e),v=0;for(let m=0;m<e;m++)v+=g[m*e+m];v/=-o;let N=[];for(let m=0;m<e;m++)for(let y=0;y<e;y++)N.push(g[m*e+y]+n[m*e+y]*v);return o===e-1&&(a=N),[p.concat(v),N]}const h=i(e)[0],c=h[h.length-1];if(c===0)return[!1,"⌹: Domain error"];for(let o=0;o<e*e;o++)a[o]/=-c;return f([e,e],a)}function E(s){return typeof s=="number"||typeof s=="string"}function R(s,e){if(typeof s!=typeof e)return 0;if(E(s))return+(s===e);if(s.shape.length!=e.shape.length)return 0;for(let t=0;t<s.shape.length;t++)if(s.shape[t]!==e.shape[t])return 0;if(s.ravel.length!=e.ravel.length)return 0;for(let t=0;t<s.ravel.length;t++)if(!R(s.ravel[t],e.ravel[t]))return 0;return 1}function q(s,e,t){const n=E(e),a=E(t);if(n&&a)return s(e,t);if(n){let c=[];for(let o=0;o<t.ravel.length;o++)c.push(s(e,t.ravel[o]));return f(t.shape,c)}if(a){let c=[];for(let o=0;o<e.ravel.length;o++)c.push(s(e.ravel[o],t));return f(e.shape,c)}const i=Math.min(e.shape.length,t.shape.length);let h=!0;for(let c=0;c<i;c++)if(e.shape[c]!=t.shape[c]){h=!1;break}if(h)if(e.shape.length>t.shape.length){const c=e.shape.slice(i).reduce((p,u)=>p*u,1);let o=[];for(let p=0;p<t.ravel.length;p++){const u=t.ravel[p];for(let g=0;g<c;g++)o.push(s(e.ravel[p*c+g],u))}return f(e.shape,o)}else{const c=t.shape.slice(i).reduce((p,u)=>p*u,1);let o=[];for(let p=0;p<e.ravel.length;p++){const u=e.ravel[p];for(let g=0;g<c;g++)o.push(s(u,t.ravel[p*c+g]))}return f(t.shape,o)}}function w(s,e){if(E(e))return s(e);let t=[];for(let n=0;n<e.ravel.length;n++)t.push(s(e.ravel[n]));return f(e.shape,t)}let l=[],I=[];const K=[r.ADD,r.SUB,r.MUL,r.DIV,r.EXP,r.LOG,r.MAX,r.MIN,r.MOD,r.EQUAL,r.NEQUAL,r.LESS,r.GREATER,r.LESSEQ,r.GREATEREQ],L=["+","-","×","÷","*","⍟","↑","↓","%","=","≠","<",">","≤","≥"],z=[(s,e)=>s+e,(s,e)=>s-e,(s,e)=>s*e,(s,e)=>s/e,Math.pow,(s,e)=>Math.log(s)/Math.log(e),Math.max,Math.min,(s,e)=>(s%e+e)%e,(s,e)=>+(s===e),(s,e)=>+(s!==e),(s,e)=>+(s<e),(s,e)=>+(s>e),(s,e)=>+(s<=e),(s,e)=>+(s>=e)];function W(s){const e=K.indexOf(s);let t=l.pop();if(t===void 0)return[!1,L[e]+": Expected a value"];let n=l.length-1;if(n<0)return[!1,L[e]+": Expected another value"];let a=q(z[e],l[n],t);if(a===void 0)return[!1,L[e]+": Shape mismatch"];l[n]=a}const Z=[r.NEGATE,r.NOT,r.CEILING,r.FLOOR],Y=["¯","~","⌈","⌊"],$=[s=>-s,s=>+!s,Math.ceil,Math.floor];function ee(s){const e=Z.indexOf(s);let t=l.length-1;if(t<0)return[!1,Y[e]+": Expected a value"];l[t]=w($[e],l[t])}function k(s){switch(s){case r.NEGATE:case r.NOT:case r.CEILING:case r.FLOOR:{const e=ee(s);if(e)return e;break}case r.ADD:case r.SUB:case r.MUL:case r.DIV:case r.EXP:case r.LOG:case r.MAX:case r.MIN:case r.MOD:case r.EQUAL:case r.NEQUAL:case r.LESS:case r.GREATER:case r.LESSEQ:case r.GREATEREQ:{const e=W(s);if(e)return e;break}case r.MATINV:{let e=l.length-1;if(e<0)return[!1,"⌹: Expected a value"];const t=B(l[e]);if(t.length&&t[0]===!1)return t;l[e]=t;break}case r.ARROPEN:{I.push(l.length);break}case r.ARRCLOSE:{if(!I.length)return[!1,"(: Mismatched parenthesis"];const e=I.pop(),t=l.length;let n=f([],[]),a=!1;for(let i=0;i<t-e;i++){const h=l.pop();let c;if(E(h)?(n.ravel.push(h),c=[]):(n.ravel=n.ravel.concat(h.ravel),c=h.shape),a===!1)a=c;else if(a.length!==c.length||!a.every((o,p)=>o===c[p]))return[!1,"(): Shape mismatch"]}n.shape.push(t-e),n.shape=n.shape.concat(a||[]),l.push(n);break}case r.DISTANCE:{const e=l.pop(),t=l.pop();if(E(e)&&E(t)){l.push(Math.abs(e-t));break}if(typeof e!=typeof t)return[!1,"|: Rank error"];if(e.ravel.length!=t.ravel.length)return[!1,"|: Length error"];let n=0;for(let a=0;a<e.ravel.length;a++){const i=e.ravel[a],h=t.ravel[a];n+=Math.pow(h-i,2)}l.push(Math.sqrt(n));break}case r.MATCH:{const e=l.pop();let t=l.length-1;l[t]=R(l[t],e);break}case r.NMATCH:{const e=l.pop();let t=l.length-1;l[t]=+!R(l[t],e);break}case r.INDEX:{const e=l.pop();let t=l.length-1;const n=l[t].ravel.length/l[t].shape[0];if(E(e)){const i=(e-1)*n;l[t]=l[t].shape.length===1?l[t].ravel[i]:f(l[t].shape.slice(1),l[t].ravel.slice(i,i+n));break}let a=[];for(let i=0;i<e.ravel.length;i++){const h=(e.ravel[i]-1)*n;a=a.concat(l[t].ravel.slice(h,h+n))}l[t]=f(e.shape.concat(l[t].shape.slice(1)),a);break}case r.REPLICATE:{let e=l.pop();if(E(e)&&(e=f([1],[e])),e.shape.length>1)return[!1,"⊃: Rank error"];let t=[];for(let n=0;n<e.ravel.length;n++)for(let a=0;a<e.ravel[n];a++)t.push(n+1);l.push(f([t.length],t));break}case r.KEEP:{let e=l.pop();const t=l.pop();if(E(t)&&E(e)){let h=[];for(let c=0;c<e;c++)h.push(t);l.push(f([h.length],h));break}if(typeof t!=typeof e)return[!1,"⊆: Rank mismatch"];if(e.ravel.length!=t.shape[0])return[!1,"⊆: Length mismatch"];let n=[],a=0,i=t.ravel.length/t.shape[0];for(let h=0;h<e.ravel.length;h++)for(let c=0;c<e.ravel[h];c++)n=n.concat(t.ravel.slice(h*i,h*i+i)),a++;l.push(f([a,...t.shape.slice(1)],n));break}case r.ROTATE:{const e=l.pop();let t=l.length-1;const n=l[t].ravel.length/l[t].shape[0];if(e>0)for(let a=0;a<e;a++){const i=l[t].ravel.splice(0,n);l[t].ravel=l[t].ravel.concat(i)}else for(let a=0;a<-e;a++){const i=l[t].ravel.splice(l[t].ravel.length-n,n);l[t].ravel=i.concat(l[t].ravel)}break}case r.REVERSE:{let e=l.length-1;const t=l[e].shape[0],n=l[e].ravel.length/t;for(let a=0;a<t/2;a++){let i=l[e].ravel.slice(a*n,a*n+n);const h=t-a-1;l[e].ravel.splice(a*n,n,...l[e].ravel.slice(h*n,h*n+n)),l[e].ravel.splice(h*n,n,...i)}break}case r.CATENATE:{let e=l.pop(),t=l.length-1;if(E(e)&&(e=f([1],[e])),E(l[t])&&(l[t]=f([1],l[t])),l[t].shape.length===e.shape.length){for(let n=1;n<l[t].shape.length;n++)if(l[t].shape[n]!==e.shape[n])return[!1,",: Shape mismatch"];l[t].shape[0]+=e.shape[0]}else if(l[t].shape.length===e.shape.length+1){for(let n=1;n<l[t].shape.length;n++)if(l[t].shape[n]!==e.shape[n-1])return[!1,",: Shape mismatch"];l[t].shape[0]++}else if(e.shape.length===l[t].shape.length+1){for(let n=1;n<e.shape.length;n++)if(e.shape[n]!==l[t].shape[n-1])return[!1,",: Shape mismatch"];l[t].shape=e.shape,l[t].shape[0]++}else return[!1,",: Shape mismatch"];l[t].ravel=e.ravel.concat(l[t].ravel);break}case r.SHAPEOF:{let e=l.length-1;E(l[e])?l[e]=f([0],[]):l[e]=f([l[e].shape.length],l[e].shape);break}case r.INDICES:{const e=l.pop();let t=[];if(E(e)){for(let n=0;n<e;n++)t.push(n+1);l.push(f([t.length],t))}else{let n=[];for(let a=0;a<e.ravel.length;a++){const i=n.findIndex(h=>R(e.ravel[a],h));i<0?(n.push(e.ravel[a]),t.push(n.length)):t.push(i+1)}l.push(f(e.shape,t))}break}case r.INDICESOF:{let e=l.pop(),t=l.pop();if(E(t)&&(t=f([1],[t])),E(e)&&(e=f([1],[e])),e.shape.length!==t.shape.length)return[!1,"⍳: Rank error"];for(let h=1;h<t.shape.length;h++)if(e.shape[h]!==t.shape[h])return[!1,"⍳: Rank error"];let n=f([0],[]),a=f([0,...t.shape.slice(1)],[]);const i=t.ravel.length/t.shape[0];for(let h=0;h<t.shape[0];h++)a.ravel=a.ravel.concat(t.ravel.slice(h*i,h*i+i)),a.shape[0]++,a.shape[0]>e.shape[0]&&(a.ravel.splice(0,i),a.shape[0]--),R(a,e)&&(n.ravel.push(h-e.shape[0]+2),n.shape[0]++);l.push(n);break}case r.FINDSEQ:{let e=l.pop(),t=l.pop();E(t)&&(t=f([1],[t])),E(e)&&(e=f([1],[e]));let n=f([0],[]),a=f([0,...t.shape.slice(1)],[]);const i=t.ravel.length/t.shape[0];for(let h=0;h<t.shape[0];h++)a.ravel=a.ravel.concat(t.ravel.slice(h*i,h*i+i)),a.shape[0]++,n.ravel.push(0),n.shape[0]++,a.shape[0]>e.shape[0]&&(a.ravel.splice(0,i),a.shape[0]--),R(a,e)&&(n.ravel[h-e.shape[0]+1]=1);l.push(n);break}case r.TAKEDROP:{let e=l.pop(),t=l.length-1;E(l[t])&&(l[t]=f([1],[l[t]])),e<0?(l[t].ravel=l[t].ravel.slice(-e*l[t].ravel.length/l[t].shape[0],l[t].ravel.length),l[t].shape[0]-=e):(l[t].ravel=l[t].ravel.slice(0,e*l[t].ravel.length/l[t].shape[0]),l[t].shape[0]=e);break}case r.RESHAPE:{let e=l.pop();if(E(e)&&(e=f([1],[e])),e.shape.length>1)return[!1,"Cannot reshape with non-vector shape."];let t=l.pop();E(t)&&(t=f([1],[t]));let n=[];const a=e.ravel.reduce((i,h)=>i*h,1);for(let i=0;i<a;i++)n.push(t.ravel[i%t.ravel.length]);l.push(f(e.ravel,n));break}case r.GRADEUP:{let e=l.pop(),t=e.ravel;for(let n=0;n<t.length;n++)t[n]=[t[n],n];t.sort(function(n,a){return n[0]<a[0]?-1:1}),l.push(f(e.shape,t.map(n=>n[1]+1)));break}case r.GRADEDOWN:{let e=l.pop(),t=e.ravel;for(let n=0;n<t.length;n++)t[n]=[t[n],n];t.sort(function(n,a){return n[0]>a[0]?-1:1}),l.push(f(e.shape,t.map(n=>n[1]+1)));break}case r.DUP:{l.push(JSON.parse(JSON.stringify(l[l.length-1])));break}case r.SWAP:{const e=l.pop(),t=l.pop();l.push(e),l.push(t);break}case r.POP:{l.pop();break}case r.NOOP:break;default:return[!1,"bytecode error on '"+Object.keys(r).find(e=>r[e]===s)+"'"]}}let T={};function A(s){let e=0;for(;e<s.length;){if(s[e]===r.ASSIGNFN){const n=s[++e];let a=s[++e];!Array.isArray(a[1])&&a[1]===r.RECUR&&(a[1]=JSON.parse(JSON.stringify(s))),T[n]=a,e++;continue}let t=[];for(;e<s.length&&s[e]===r.CONST||s[e]===r.NAME;){if(s[e]===r.NAME){const n=JSON.parse(JSON.stringify(T[s[++e]]));if(Array.isArray(n)){const a=A(n);if(a.length&&a[0]===!1)return a}else l.push(n)}else l.push(s[++e]);e++}for(;e<s.length&&[r.FOLD,r.SCAN,r.DIP,r.REPEAT,r.UNTIL,r.IF].includes(s[e]);)t.push(s[e++]);if(!(e>=s.length)){if(s[e]===r.ASSIGN){if(t.length)return[!1,"bytecode error: modifiers for ←"];T[s[++e]]=l.pop(),e++;continue}if(t.length===0)if(s[e]===r.FUNCTION){const n=A(s[++e]);if(n.length&&n[0]===!1)return n}else if(s[e]===r.RECUR){const n=A(s);if(n.length&&n[0]===!1)return n}else{const n=k(s[e]);if(n)return n}else{let n;if(s[e]===r.FUNCTION){e++;const i=s[e];n=()=>{const h=A(i);if(h.length&&h[0]===!1)return h}}else if(s[e]===r.RECUR)n=()=>{const i=A(s);if(i.length&&i[0]===!1)return i};else{const i=s[e];n=()=>{const h=k(i);if(h)return h}}for(;t.length>0;){const i=t.pop(),h=n;let c;if([r.UNTIL,r.IF].includes(i))if(e++,s[e]===r.FUNCTION){e++;const o=s[e];c=()=>{const p=A(o);if(p.length&&p[0]===!1)return p}}else if(s[e]===r.RECUR)c=()=>{const o=A(s);if(o.length&&o[0]===!1)return o};else{const o=s[e];c=()=>{const p=k(o);if(p)return p}}switch(i){case r.FOLD:{n=()=>{const o=l.pop(),p=o.ravel.length/o.shape[0];if(o.shape[0]===0)l.push(f(o.shape.slice(1),new Array(o.shape.slice(1).reduce((u,g)=>u*g,1)).fill().map(u=>0)));else if(o.shape[0]===1)l.push(o.shape.length===1?o.ravel[0]:f(o.shape.slice(1),o.ravel));else{const u=o.ravel.slice(0,p);l.push(o.shape.length===1?u[0]:f(o.shape.slice(1),u));for(let g=1;g<o.shape[0];g++){const v=o.ravel.slice(g*p,g*p+p);l.push(o.shape.length===1?v[0]:f(o.shape.slice(1),v));const N=h();if(N)return N}}};break}case r.SCAN:{n=()=>{const o=l.pop(),p=o.ravel.length/o.shape[0];if(o.shape[0]===0)l.push(f([0,...o.shape.slice(1)],[]));else if(o.shape[0]===1)l.push(f([1,...o.shape.slice(1)],o.ravel));else{let u=f(o.shape,[]);const g=o.ravel.slice(0,p);l.push(o.shape.length===1?g[0]:f(o.shape.slice(1),g)),u.ravel=u.ravel.concat(g);for(let v=1;v<o.shape[0];v++){const N=o.ravel.slice(v*p,v*p+p);l.push(o.shape.length===1?N[0]:f(o.shape.slice(1),N));const m=h();if(m)return m;u.ravel=u.ravel.concat(E(l[l.length-1])?l[l.length-1]:l[l.length-1].ravel)}l.pop(),l.push(u)}};break}case r.DIP:{n=()=>{const o=l.pop(),p=h();if(p)return p;l.push(o)};break}case r.REPEAT:{n=()=>{const o=l.pop(),p=l.pop();l.push(w(u=>{l.push(p);for(let g=0;g<u;g++)h();return l.pop()},o))};break}case r.UNTIL:{n=()=>{let o=!1;for(;;){c();const p=JSON.parse(JSON.stringify(l[l.length-1]));if(o!==!1){const u=JSON.parse(JSON.stringify(l));l.push(o),h();let g=l.pop();if(l=u,g===1)break}o=p}};break}case r.IF:{n=()=>{const o=l.pop();let p=0;const u=JSON.parse(JSON.stringify(l));(E(o)?o:o.ravel[0])?h():c();const g=l.pop();p=u.length-l.length,l=u;for(let v=0;v<p;v++)l.pop();l.push(g)};break}default:return[!1,"bytecode error on '"+Object.keys(r).find(o=>r[o]===i)+"'"]}}const a=n();if(a)return a}e++,s[e]===r.ASSIGN&&(T[s[++e]]=l.pop(),e++)}}return I.length?[!1,"): Mismatched parenthesis"]:l.map(te).join(`
`)}function te(s){if(typeof s=="object"){let e=[],t=1;for(let a=s.shape.length-1;a>=0;a--)t*=s.shape[a],e.push(t);let n="";s.ravel.length||(s.shape.length>1?n+="⍬["+s.shape+"]":n+="⍬");for(let a=0;a<s.ravel.length;a++){if(a!==0)for(let i of e)a%i===0&&(n+=`
`);n+=""+s.ravel[a]+(typeof s.ravel[a]=="string"?"":" ")}return n}else return""+s}function F(s){let e=J(s);if(e.length&&e[0]===!1){let a="error: "+e[1]+`

`,i=0;for(let h of s.split(`
`)){const c=i;if(i+=h.length+1,i>e[2]){a+=h+`
`,a+=" ".repeat(e[2]-c),a+=`↑ here
`;break}}return a}e=e.filter(a=>a!==`
`);const t=V(e);if(t.length&&t[0]===!1)return t[1];l=[],I=[];const n=A(t);return n.length&&n[0]===!1?n[1]:n}runresult.innerText=F(d.value);
